(function(window,document){function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length};"use strict";var isComponent=typeof module==="object"&&"require"in window,isIframe=top!==self,_Emitter;if(isComponent){_Emitter=require("emitter")}else{_Emitter=Emitter}function PostEmitter(options){this.isIframe=isIframe;this.options=options||{};this._emitter=new _Emitter;this.el=isIframe?null:this.getFrame(this.options.selector);this.prefix=new RegExp("^"+this.options.prefix);this.prefixLength=this.options.prefix.length;this.setOrigin(this.options.origin);this.addListener()}PostEmitter.prototype.getFrame=function(selector){if(!("querySelector"in document)){this._emitter.emit("error",new Error('"querySelector" is needed to target iframe'));return}return document.querySelector(selector)};PostEmitter.prototype.on=function(){this._emitter.on.apply(this._emitter,arguments)};PostEmitter.prototype.emit=function(){var args=Array.prototype.slice.call(arguments,0),event=this.serialize(args);var target=this.isIframe?window.parent:this.el?this.el.contentWindow:null;if(!target)return;if(typeof target.postMessage!=="function"){this._emitter.emit("error",new Error(event[0]+" not sent,"+'"postMessage" is needed to communicate with iframe'));return}target.postMessage(event,this._origin)};PostEmitter.prototype.setOrigin=function(origin){this._origin=origin||"*"};PostEmitter.prototype.onMessage=function(e){if(!this.prefix.test(e.data)){return}var msg=this.deserialize(e.data);if(!msg){this._emitter.emit("error",new Error("could not parse event: "+e.data));return}if(!Array.isArray(msg)){this._emitter.emit("error",new Error("expected an array from postMessage instead got: "+e.data));return}this._emitter.emit.apply(this._emitter,msg)};PostEmitter.prototype.deserialize=function(msg){var json=msg.slice(this.prefixLength);var obj=null;try{obj=JSON.parse(json)}catch(e){obj=null;this.emit("error",e)}return obj};PostEmitter.prototype.serialize=function(msg){return this.options.prefix+JSON.stringify(msg)};PostEmitter.prototype.addListener=function(){if(!("addEventListener"in window&&Function.prototype.hasOwnProperty("bind"))){return this._emitter.emit("error",new Error('"addEventListener" & ".bind()" needed to listen for messages'))}window.addEventListener("message",this.onMessage.bind(this),false)};PostEmitter.inIframe=isIframe;if(isComponent){module.exports=PostEmitter}if(typeof onPostEmitterReady==="function"){onPostEmitterReady(PostEmitter)}"use strict";function Hone(options){this.options=options||{};this.current=this.options.hone;this.postEmitter=new PostEmitter(this.options);this.el=this.postEmitter.el}Hone.prototype.setSrc=function(opts){var domain=opts.domain||"http://gohone.com",debug=opts.debug?"&debug=true":"",type=opts.ad?"AdUnit":"Quiz",id=this.el.getAttribute("data-hone");this.el.src=domain+"/"+type+"/"+id+"?embed=true"+debug};Hone.prototype.onIframeResize=function(){var el=this.postEmitter.el;return function(e){if(typeof e.clientHeight!=="number")return;el.style.height=e.clientHeight+"px"}};Hone.prototype.on=function(){this.postEmitter.on.apply(this.postEmitter,arguments)};Hone.prototype.emit=function(){this.postEmitter.emit.apply(this.postEmitter,arguments)};Hone.prototype.urlParser=Hone.urlParser=function(url){var resource,id;if(typeof url!=="string")return;url=url.split(/\//);resource=url[url.length-2];id=url[url.length-1];if(!resource)return;if(resource.toLowerCase()!=="contest")return;id=id.split(/\?/).shift();return{contestId:id,isContest:true}};Hone.prototype.init=function(opts){opts=opts||{};if(!this.el.src)this.setSrc(opts);if(opts.resize||this.el.getAttribute("data-resize")){this.on("resize",this.onIframeResize())}};var el="querySelector"in document?document.querySelector("[data-hone]"):null,url,hone;if(el){url=el.src;hone=new Hone({selector:"[data-hone]",hone:Hone.urlParser(url)||{},prefix:"Hone:"})}if(typeof onHoneReady==="function")return onHoneReady(hone);window.hone=hone})(window,document);